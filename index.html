<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班级管理系统</title>
    <!-- 外部资源引入 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .sidebar-link {
                @apply flex items-center px-4 py-3 text-gray-200 hover:bg-blue-700 transition-colors duration-200 rounded-md;
            }
            .sidebar-link.active {
                @apply bg-blue-700;
            }
            .action-btn {
                @apply px-3 py-1 rounded text-sm font-medium;
            }
            .action-btn-primary {
                @apply bg-blue-600 text-white hover:bg-blue-700;
            }
            .action-btn-danger {
                @apply bg-red-600 text-white hover:bg-red-700;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">
    <!-- 登录页面 -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-gray-100 p-4">
        <div class="bg-white rounded-lg shadow-xl overflow-hidden w-full max-w-md">
            <div class="p-6 sm:p-8">
                <div class="text-center mb-8">
                    <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/64bfd761e7284e2ca4149d44fd8884b1~tplv-a9rns2rl98-image.image?rcl=2025103114221315A5A8FEF816AE360D6D&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1764483800&x-signature=0kXWQWr8BDYT5ou7yQZm938g%2Fyw%3D" 
                         alt="班级管理系统" class="h-20 mx-auto mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">班级管理系统</h2>
                    <p class="text-gray-600 mt-1">请使用授权账号登录</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="username" name="username" 
                                   class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="请输入用户名" required>
                        </div>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-lock"></i>
                            </span>
                            <input type="password" id="password" name="password" 
                                   class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="请输入密码" required>
                        </div>
                    </div>
                    <div>
                        <label for="user-role" class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-users"></i>
                            </span>
                            <select id="user-role" name="userRole" 
                                    class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                    required>
                                <option value="">请选择角色</option>
                                <option value="admin">管理员</option>
                                <option value="teacher">教师</option>
                                <option value="student">学生</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <button type="submit" 
                                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            登录
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 主应用界面（默认隐藏） -->
    <div id="app" class="hidden flex h-screen overflow-hidden">
        <!-- 侧边栏导航 -->
        <aside class="bg-blue-800 text-white w-64 flex-shrink-0 hidden md:block">
            <div class="p-6">
                <h1 class="text-xl font-bold flex items-center">
                    <i class="fa fa-graduation-cap mr-2"></i>
                    班级管理系统
                </h1>
            </div>
            <nav class="px-2 py-4 space-y-1">
                <a href="#" data-page="dashboard" class="sidebar-link nav-link">
                    <i class="fa fa-dashboard w-5 mr-3"></i>
                    <span>仪表盘</span>
                </a>
                <a href="#" data-page="members" class="sidebar-link nav-link">
                    <i class="fa fa-user-circle w-5 mr-3"></i>
                    <span>班级人员管理</span>
                </a>
                <a href="#" data-page="committee" class="sidebar-link nav-link">
                    <i class="fa fa-users w-5 mr-3"></i>
                    <span>班委会管理</span>
                </a>
                <a href="#" data-page="schedule" class="sidebar-link nav-link">
                    <i class="fa fa-calendar w-5 mr-3"></i>
                    <span>值日安排管理</span>
                </a>
                <a href="#" data-page="activities" class="sidebar-link nav-link">
                    <i class="fa fa-calendar-check-o w-5 mr-3"></i>
                    <span>班级活动记录</span>
                </a>
                <a href="#" data-page="messages" class="sidebar-link nav-link">
                    <i class="fa fa-comments w-5 mr-3"></i>
                    <span>班级留言簿</span>
                </a>
                <a href="#" data-page="reflection" class="sidebar-link nav-link">
                    <i class="fa fa-code w-5 mr-3"></i>
                    <span>反射机制演示</span>
                </a>
                <a href="#" data-page="map" class="sidebar-link nav-link">
                    <i class="fa fa-map w-5 mr-3"></i>
                    <span>映射应用演示</span>
                </a>
                <a href="#" data-page="socket" class="sidebar-link nav-link">
                    <i class="fa fa-exchange w-5 mr-3"></i>
                    <span>Socket通信</span>
                </a>
            </nav>
        </aside>

        <!-- 主内容区域 -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- 顶部导航栏 -->
            <header class="bg-white shadow-sm px-6 py-3 flex justify-between items-center">
                <button id="mobile-menu-btn" class="md:hidden text-gray-600 focus:outline-none">
                    <i class="fa fa-bars text-xl"></i>
                </button>
                <h2 id="page-title" class="text-xl font-semibold">仪表盘</h2>
                <div class="flex items-center">
                    <div class="relative ml-3">
                        <div class="flex items-center">
                            <span id="user-initial" class="h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-medium">A</span>
                            <div class="ml-3 hidden md:block">
                                <div id="user-name" class="text-sm font-medium text-gray-700">管理员</div>
                                <div id="user-role" class="text-xs text-gray-500">admin</div>
                            </div>
                            <button id="logout-btn" class="ml-4 text-gray-600 hover:text-gray-900">
                                <i class="fa fa-sign-out"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 页面内容区域 -->
            <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
                <!-- 仪表盘页面 -->
                <div id="dashboard-page" class="page-content">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">班级概览</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-blue-600">总人数</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-1">45</h3>
                                        </div>
                                        <div class="h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center">
                                            <i class="fa fa-users text-blue-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-green-50 p-6 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-green-600">本月活动</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-1">3</h3>
                                        </div>
                                        <div class="h-12 w-12 bg-green-100 rounded-full flex items-center justify-center">
                                            <i class="fa fa-calendar-check-o text-green-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-purple-50 p-6 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-purple-600">留言数</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-1">28</h3>
                                        </div>
                                        <div class="h-12 w-12 bg-purple-100 rounded-full flex items-center justify-center">
                                            <i class="fa fa-comments text-purple-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-medium text-gray-800 mb-4">班级活动统计</h3>
                                <div class="h-64">
                                    <canvas id="activity-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 班级人员管理页面 -->
                <div id="members-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-semibold text-gray-800">班级人员管理</h2>
                                <button id="add-member-btn" class="action-btn action-btn-primary">
                                    <i class="fa fa-plus mr-1"></i> 添加成员
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">姓名</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">学号</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">性别</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">联系方式</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">张三</td>
                                            <td class="px-6 py-4 whitespace-nowrap">2023001</td>
                                            <td class="px-6 py-4 whitespace-nowrap">男</td>
                                            <td class="px-6 py-4 whitespace-nowrap">13800138000</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <button class="text-blue-600 hover:text-blue-900 mr-3 edit-member">编辑</button>
                                                <button class="text-red-600 hover:text-red-900 delete-member">删除</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">李四</td>
                                            <td class="px-6 py-4 whitespace-nowrap">2023002</td>
                                            <td class="px-6 py-4 whitespace-nowrap">女</td>
                                            <td class="px-6 py-4 whitespace-nowrap">13900139000</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <button class="text-blue-600 hover:text-blue-900 mr-3 edit-member">编辑</button>
                                                <button class="text-red-600 hover:text-red-900 delete-member">删除</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他页面结构保持不变 -->
                <div id="committee-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">班委会管理</h2>
                            <p class="text-gray-600 mb-6">当前班委会成员及职责管理</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h3 class="font-medium text-gray-800 mb-3">班长</h3>
                                    <p class="text-gray-600">张三 (负责班级全面工作)</p>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h3 class="font-medium text-gray-800 mb-3">学习委员</h3>
                                    <p class="text-gray-600">李四 (负责学习相关工作)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="schedule-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">值日安排管理</h2>
                            <p class="text-gray-600 mb-6">本周值日表安排</p>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">星期</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">值日人员</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">周一</td>
                                            <td class="px-6 py-4 whitespace-nowrap">张三、李四</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">已完成</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="activities-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">班级活动记录</h2>
                            <div class="space-y-6">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-medium text-gray-800">秋季运动会</h3>
                                            <p class="text-sm text-gray-500 mt-1">2023-10-26</p>
                                        </div>
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">体育活动</span>
                                    </div>
                                    <p class="text-gray-600 mt-3">
                                        班级参加学校秋季运动会，获得团体总分第三名
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="messages-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">班级留言簿</h2>
                            <div class="mb-6">
                                <textarea id="message-input" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="写下你的留言..."></textarea>
                                <div class="mt-3 flex justify-end">
                                    <button id="send-message-btn" class="action-btn action-btn-primary">
                                        发送留言
                                    </button>
                                </div>
                            </div>
                            <div id="messages-list" class="space-y-4">
                                <div class="border-l-4 border-blue-500 pl-4 py-2">
                                    <div class="flex justify-between">
                                        <h4 class="font-medium text-gray-800">张三</h4>
                                        <p class="text-sm text-gray-500">2023-11-01 09:30</p>
                                    </div>
                                    <p class="text-gray-600 mt-1">下周的班会主题建议讨论学习方法分享</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reflection-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">反射机制演示</h2>
                            <p class="text-gray-600 mb-6">反射机制允许程序在运行时动态调用函数</p>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <div class="mb-4">
                                    <input type="text" id="function-name" value="greet" class="w-full p-2 border rounded mb-2" placeholder="函数名">
                                    <input type="text" id="function-args" value="'班级管理系统'" class="w-full p-2 border rounded mb-2" placeholder="参数">
                                    <button id="invoke-function-btn" class="action-btn action-btn-primary">调用函数</button>
                                    <pre id="reflection-result" class="mt-4 p-3 bg-white border rounded">> greet('班级管理系统')
欢迎使用班级管理系统!</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="map-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">映射应用演示</h2>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-medium mb-3">添加用户</h4>
                                        <input type="text" id="user-id" placeholder="用户ID" class="w-full p-2 border rounded mb-2">
                                        <input type="text" id="user-name-map" placeholder="姓名" class="w-full p-2 border rounded mb-2">
                                        <button id="add-user-btn" class="action-btn action-btn-primary">添加</button>
                                    </div>
                                    <div>
                                        <h4 class="font-medium mb-3">查询用户</h4>
                                        <input type="text" id="search-user-id" placeholder="用户ID" class="w-full p-2 border rounded mb-2">
                                        <button id="search-user-btn" class="action-btn action-btn-primary">查询</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="socket-page" class="page-content hidden">
                    <div class="bg-white rounded-lg shadow mb-6">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Socket通信演示</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-1">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h3 class="font-medium mb-4">在线用户</h3>
                                        <ul id="online-users" class="space-y-2">
                                            <li class="flex items-center p-2 bg-white rounded border">
                                                <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span>
                                                <span>系统管理员</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="lg:col-span-2">
                                    <div class="bg-gray-50 p-4 rounded-lg h-[400px] flex flex-col">
                                        <div id="chat-messages" class="flex-1 overflow-y-auto mb-4 space-y-3">
                                            <div class="text-center">
                                                <span class="text-xs bg-gray-200 text-gray-600 px-3 py-1 rounded-full">今天 14:30</span>
                                            </div>
                                            <div class="flex items-start">
                                                <span class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-sm mr-2">系</span>
                                                <div>
                                                    <div class="bg-blue-100 rounded-lg rounded-tl-none px-4 py-2 text-sm">
                                                        欢迎来到班级聊天系统！
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <input type="text" id="chat-input" placeholder="输入消息..." class="flex-1 px-4 py-2 border rounded">
                                            <button id="send-chat-btn" class="action-btn action-btn-primary">发送</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // 1. 系统核心配置
        // 授权用户列表（实际项目中应存储在后端数据库）
        const authorizedUsers = [
            { username: 'admin', password: 'admin123', role: 'admin', name: '系统管理员' },
            { username: 'teacher', password: 'teacher123', role: 'teacher', name: '王老师' },
            { username: 'student', password: 'student123', role: 'student', name: '张三同学' }
        ];

        // 角色权限配置（页面访问权限）
        const rolePagePermissions = {
            admin: [
                'dashboard', 'members', 'committee', 
                'schedule', 'activities', 'messages',
                'reflection', 'map', 'socket'
            ],
            teacher: [
                'dashboard', 'members', 'committee', 
                'schedule', 'activities', 'messages'
            ],
            student: [
                'dashboard', 'schedule', 'activities', 'messages'
            ]
        };

        // 角色操作权限配置（功能按钮权限）
        const roleActionPermissions = {
            admin: [
                'addMember', 'editMember', 'deleteMember',
                'manageCommittee', 'manageSchedule', 'manageActivities'
            ],
            teacher: [
                'addMember', 'editMember', 'manageSchedule', 'manageActivities'
            ],
            student: [
                'viewContent', 'sendMessage'
            ]
        };

        // 2. DOM元素初始化
        const loginForm = document.getElementById('login-form');
        const loginPage = document.getElementById('login-page');
        const app = document.getElementById('app');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageTitle = document.getElementById('page-title');
        const pageContents = document.querySelectorAll('.page-content');
        const logoutBtn = document.getElementById('logout-btn');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');

        // 3. 登录验证逻辑
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const role = document.getElementById('user-role').value;
            
            // 验证用户身份
            const validUser = authorizedUsers.find(user => 
                user.username === username && 
                user.password === password && 
                user.role === role
            );
            
            if (validUser) {
                // 登录成功 - 保存用户信息
                localStorage.setItem('currentUser', JSON.stringify(validUser));
                initApp(validUser);
            } else {
                // 登录失败提示
                alert('用户名、密码或角色不匹配，请重新输入');
            }
        });

        // 4. 初始化应用
        function initApp(user) {
            // 切换页面显示
            loginPage.classList.add('hidden');
            app.classList.remove('hidden');
            
            // 更新用户信息展示
            document.getElementById('user-initial').textContent = user.name.charAt(0).toUpperCase();
            document.getElementById('user-name').textContent = user.name;
            document.getElementById('user-role').textContent = 
                user.role === 'admin' ? '管理员' : 
                user.role === 'teacher' ? '教师' : '学生';
            
            // 设置权限
            setupPermissions(user.role);
            
            // 初始化默认页面
            showPage('dashboard');
            initDashboardChart();
        }

        // 5. 权限设置
        function setupPermissions(role) {
            // 页面访问权限控制
            const allowedPages = rolePagePermissions[role];
            navLinks.forEach(link => {
                const page = link.getAttribute('data-page');
                if (allowedPages.includes(page)) {
                    link.classList.remove('hidden');
                } else {
                    link.classList.add('hidden');
                }
            });

            // 操作按钮权限控制
            const allowedActions = roleActionPermissions[role];
            
            // 成员管理操作权限
            document.getElementById('add-member-btn')?.classList.toggle('hidden', 
                !allowedActions.includes('addMember'));
            
            document.querySelectorAll('.edit-member').forEach(btn => {
                btn.classList.toggle('hidden', !allowedActions.includes('editMember'));
            });
            
            document.querySelectorAll('.delete-member').forEach(btn => {
                btn.classList.toggle('hidden', !allowedActions.includes('deleteMember'));
            });
        }

        // 6. 页面切换功能
        function showPage(pageId) {
            // 权限检查
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!rolePagePermissions[currentUser.role].includes(pageId)) {
                alert('您没有访问该页面的权限');
                return;
            }
            
            // 切换页面显示
            pageContents.forEach(page => page.classList.add('hidden'));
            document.getElementById(`${pageId}-page`).classList.remove('hidden');
            
            // 更新标题和导航状态
            const pageTitleText = document.querySelector(`.nav-link[data-page="${pageId}"] span`).textContent;
            pageTitle.textContent = pageTitleText;
            
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('data-page') === pageId);
            });
        }

        // 7. 登出功能
        logoutBtn.addEventListener('click', function() {
            if (confirm('确定要退出登录吗？')) {
                localStorage.removeItem('currentUser');
                app.classList.add('hidden');
                loginPage.classList.remove('hidden');
                loginForm.reset();
            }
        });

        // 8. 导航点击事件
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('data-page');
                showPage(pageId);
            });
        });

        // 9. 其他功能初始化
        function initDashboardChart() {
            const ctx = document.getElementById('activity-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['一月', '二月', '三月', '四月', '五月', '六月'],
                    datasets: [{
                        label: '班级活动数量',
                        data: [2, 3, 1, 4, 2, 3],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        // 10. 页面加载时检查登录状态
        window.addEventListener('load', function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                initApp(JSON.parse(savedUser));
            }
        });

        // 11. 移动端菜单切换
        mobileMenuBtn.addEventListener('click', function() {
            const sidebar = document.querySelector('aside');
            sidebar.classList.toggle('hidden');
        });

        // 12. 留言功能
        document.getElementById('send-message-btn').addEventListener('click', function() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const now = new Date().toLocaleString();
            
            const messageEl = document.createElement('div');
            messageEl.className = 'border-l-4 border-blue-500 pl-4 py-2';
            messageEl.innerHTML = `
                <div class="flex justify-between">
                    <h4 class="font-medium">${user.name}</h4>
                    <p class="text-sm text-gray-500">${now}</p>
                </div>
                <p class="text-gray-600 mt-1">${message}</p>
            `;
            
            document.getElementById('messages-list').prepend(messageEl);
            input.value = '';
        });
    </script>
</body>
</html>
