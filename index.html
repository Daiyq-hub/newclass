<!-- 修改登录表单及权限验证相关代码 -->
<div id="login-page" class="min-h-screen flex items-center justify-center bg-gray-100 p-4">
    <div class="bg-white rounded-lg shadow-xl overflow-hidden w-full max-w-md">
        <div class="p-6 sm:p-8">
            <div class="text-center mb-8">
                <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/64bfd761e7284e2ca4149d44fd8884b1~tplv-a9rns2rl98-image.image?rcl=2025103114221315A5A8FEF816AE360D6D&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1764483800&x-signature=0kXWQWr8BDYT5ou7yQZm938g%2Fyw%3D" alt="班级管理系统" class="h-20 mx-auto mb-4">
                <h2 class="text-2xl font-bold text-gray-800">班级管理系统</h2>
                <p class="text-gray-600 mt-1">请登录您的账户</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                            <i class="fa fa-user"></i>
                        </span>
                        <input type="text" id="username" name="username" class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入用户名" required>
                    </div>
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                            <i class="fa fa-lock"></i>
                        </span>
                        <input type="password" id="password" name="password" class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入密码" required>
                    </div>
                </div>
                <div>
                    <label for="user-role" class="block text-sm font-medium text-gray-700 mb-1">角色</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                            <i class="fa fa-users"></i>
                        </span>
                        <select id="user-role" name="userRole" class="pl-10 block w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">请选择角色</option>
                            <option value="admin">管理员</option>
                            <option value="teacher">教师</option>
                            <option value="student">学生</option>
                        </select>
                    </div>
                </div>
                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        登录
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 修改登录处理逻辑 -->
<script>
    // 用户角色权限配置
    const rolePermissions = {
        admin: {
            pages: ['dashboard', 'members', 'committee', 'schedule', 'activities', 'messages', 'reflection', 'map', 'socket'],
            actions: ['addMember', 'deleteMember', 'editMember', 'manageCommittee', 'manageSchedule', 'manageActivities', 'manageMessages']
        },
        teacher: {
            pages: ['dashboard', 'members', 'committee', 'schedule', 'activities', 'messages', 'reflection', 'map', 'socket'],
            actions: ['addMember', 'editMember', 'manageCommittee', 'manageSchedule', 'manageActivities', 'manageMessages']
        },
        student: {
            pages: ['dashboard', 'members', 'schedule', 'activities', 'messages', 'reflection', 'map', 'socket'],
            actions: ['viewMessages', 'addMessage']
        }
    };

    // 当前登录用户信息
    let currentUser = {
        username: '',
        role: '',
        permissions: {}
    };

    // 登录表单提交
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const role = document.getElementById('user-role').value;
        
        // 简单验证
        if (!username || !password || !role) {
            alert('请填写完整登录信息');
            return;
        }
        
        // 模拟用户验证（实际应用中应该与后端交互）
        const isValidUser = true; // 这里应该是实际的验证逻辑
        
        if (isValidUser) {
            // 设置当前用户信息
            currentUser = {
                username,
                role,
                permissions: rolePermissions[role] || {}
            };
            
            // 显示主应用界面
            loginPage.classList.add('hidden');
            app.classList.remove('hidden');
            
            // 更新用户信息
            document.getElementById('user-initial').textContent = username.charAt(0);
            document.getElementById('user-name').textContent = username;
            document.getElementById('user-role').textContent = 
                role === 'admin' ? '管理员' : 
                role === 'teacher' ? '教师' : '学生';
            
            // 根据权限过滤导航菜单
            filterNavByPermissions();
            
            // 默认显示仪表盘页面
            showPage('dashboard');
        } else {
            alert('用户名或密码错误');
        }
    });

    // 根据权限过滤导航菜单
    function filterNavByPermissions() {
        const allowedPages = currentUser.permissions.pages || [];
        navLinks.forEach(link => {
            const page = link.getAttribute('data-page');
            if (!allowedPages.includes(page)) {
                link.style.display = 'none';
            } else {
                link.style.display = 'flex';
            }
        });
        
        // 根据权限隐藏特定操作按钮
        if (!currentUser.permissions.actions?.includes('addMember')) {
            document.getElementById('add-member-btn')?.classList.add('hidden');
        }
        
        if (currentUser.role === 'student') {
            document.getElementById('clear-all-btn')?.classList.add('hidden');
        }
    }

    // 修改显示页面函数，增加权限检查
    function showPage(pageId) {
        // 检查权限
        if (!currentUser.permissions.pages?.includes(pageId)) {
            alert('您没有访问该页面的权限');
            return;
        }
        
        // 更新页面标题
        const pageTitleMap = {
            'dashboard': '仪表盘',
            'members': '班级人员管理',
            'committee': '班委会管理',
            'schedule': '值日安排管理',
            'activities': '班级活动记录',
            'messages': '班级留言簿',
            'reflection': '反射机制演示',
            'map': '映射应用演示',
            'socket': 'Socket通信'
        };
        
        pageTitle.textContent = pageTitleMap[pageId] || '仪表盘';
        
        // 隐藏所有页面内容
        pageContents.forEach(page => {
            page.classList.add('hidden');
        });
        
        // 显示指定页面内容
        const targetPage = document.getElementById(`${pageId}-page`);
        if (targetPage) {
            targetPage.classList.remove('hidden');
        }
        
        // 更新导航链接状态
        navLinks.forEach(link => {
            if (link.getAttribute('data-page') === pageId) {
                link.classList.add('bg-blue-700');
            } else {
                link.classList.remove('bg-blue-700');
            }
        });
    }
</script>

<!-- 隐藏代码展示区域 - 反射机制演示页面 -->
<div id="reflection-page" class="page-content hidden">
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">反射机制演示</h2>
            <p class="text-gray-600 mb-6">
                反射机制允许程序在运行时动态地调用函数、访问属性或创建对象。在JavaScript中，可以通过eval()函数或Function构造函数实现这一功能。
                以下演示了如何使用反射机制将字符串作为函数名进行调用。
            </p>
            
            <div class="bg-gray-50 p-6 rounded-lg mb-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">反射机制示例</h3>
                <div class="mb-4">
                    <label for="function-name" class="block text-sm font-medium text-gray-700 mb-1">函数名称</label>
                    <div class="flex space-x-3">
                        <input type="text" id="function-name" class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="例如: add, multiply, greet" value="greet">
                        <label for="function-args" class="block text-sm font-medium text-gray-700 mb-1">参数</label>
                        <input type="text" id="function-args" class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="例如: '参数1', 2, true" value="'班级管理系统'">
                        <button id="invoke-function-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            调用函数
                        </button>
                    </div>
                    <div class="mt-4">
                        <p class="text-sm font-medium text-gray-700 mb-2">可用函数:</p>
                        <ul class="list-disc pl-5 text-sm text-gray-600">
                            <li><code>add(a, b)</code> - 计算两个数的和</li>
                            <li><code>multiply(a, b)</code> - 计算两个数的积</li>
                            <li><code>greet(name)</code> - 向指定名称的人打招呼</li>
                            <li><code>reverseString(str)</code> - 反转字符串</li>
                            <li><code>getCurrentTime()</code> - 获取当前时间</li>
                        </ul>
                    </div>
                    
                    <div class="mt-6 p-4 bg-white rounded-md border border-gray-200">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">结果:</h4>
                        <pre id="reflection-result" class="text-sm text-gray-600 p-3 bg-gray-50 rounded-md overflow-x-auto">
> greet('班级管理系统')
欢迎使用班级管理系统!</pre>
                    </div>
                </div>
            </div>
            
            <!-- 隐藏代码展示区域 -->
            <div style="display: none;">
                <h3 class="text-lg font-medium text-gray-800 mb-4">实现代码</h3>
                <div class="bg-gray-900 rounded-lg p-6">
                    <pre class="text-gray-300 overflow-x-auto">
                    <!-- 代码内容已隐藏 -->
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 隐藏代码展示区域 - 映射应用演示页面 -->
<div id="map-page" class="page-content hidden">
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">映射应用演示</h2>
            
            <p class="text-gray-600 mb-6">
                映射（Map）是一种键值对数据结构，类似于对象，但具有更多的功能和灵活性。
                在JavaScript中，Map对象可以使用任意类型作为键，并且提供了丰富的方法来操作数据。
                以下演示了如何使用Map实现用户数据的管理功能。
            </p>
            
            <div class="bg-gray-50 p-6 rounded-lg mb-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">用户数据管理系统</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- 添加用户表单 -->
                    <!-- 内容保持不变 -->
                </div>
                
                <div>
                    <h4 class="text-md font-medium text-gray-800 mb-3">用户列表</h4>
                    <!-- 用户列表表格 -->
                    <!-- 内容保持不变 -->
                </div>
            </div>
            
            <!-- 隐藏代码展示区域 -->
            <div style="display: none;">
                <h3 class="text-lg font-medium text-gray-800 mb-4">实现代码</h3>
                <div class="bg-gray-900 rounded-lg p-6">
                    <pre class="text-gray-300 overflow-x-auto">
                    <!-- 代码内容已隐藏 -->
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 隐藏代码展示区域 - Socket通信页面 -->
<div id="socket-page" class="page-content hidden">
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Socket通信演示</h2>
            <p class="text-gray-600 mb-6">
                Socket通信允许在不同设备之间进行实时数据交换。在Web应用中，可以使用WebSocket API实现浏览器与服务器之间的全双工通信。
                以下演示了如何使用WebSocket实现两个用户之间的在线聊天功能。
            </p>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- 聊天区域和在线用户列表 -->
                <!-- 内容保持不变 -->
            </div>
            
            <!-- 隐藏代码展示区域 -->
            <div style="display: none;">
                <h3 class="text-lg font-medium text-gray-800 mb-4">实现代码</h3>
                <div class="bg-gray-900 rounded-lg p-6">
                    <pre class="text-gray-300 overflow-x-auto">
                    <!-- 代码内容已隐藏 -->
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>
